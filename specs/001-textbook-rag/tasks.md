# Tasks: AI-Native Textbook with RAG Chatbot

**Input**: Design documents from `/specs/001-textbook-rag/`
**Prerequisites**: plan.md (required), spec.md (required), research.md, data-model.md, contracts/

**Tests**: Not explicitly requested - tests are omitted.

**Organization**: Tasks are grouped by user story to enable independent implementation and testing.

## Format: `[ID] [P?] [Story] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- **[Story]**: Which user story this task belongs to (e.g., US1, US2, US3)
- Include exact file paths in descriptions

## Path Conventions

- **Frontend**: `website/` (Docusaurus)
- **Backend**: `backend/` (FastAPI)
- **Content**: `docs/` (Markdown chapters)

---

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: Project initialization and basic structure for both frontend and backend

- [X] T001 Create project directory structure per implementation plan (docs/, website/, backend/)
- [X] T002 [P] Initialize Docusaurus 3.x project in website/ with npm
- [X] T003 [P] Initialize Python 3.11 project with venv in backend/
- [X] T004 [P] Create backend/requirements.txt with FastAPI, qdrant-client, groq, sentence-transformers, python-dotenv
- [X] T005 [P] Create website/package.json dependencies for Docusaurus
- [X] T006 [P] Create .env.example files for both frontend and backend with required variables
- [X] T007 [P] Create .gitignore with node_modules, venv, .env, __pycache__, build/

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: Core infrastructure that MUST be complete before ANY user story can be implemented

**âš ï¸ CRITICAL**: No user story work can begin until this phase is complete

- [X] T008 Create backend/src/config.py with environment variable loading (QDRANT_URL, GROQ_API_KEY, DATABASE_URL, CORS_ORIGINS)
- [X] T009 [P] Create backend/src/models/schemas.py with Pydantic models: ChatRequest, ContextualChatRequest, ChatResponse, Source, HealthResponse, ErrorResponse per contracts/openapi.yaml
- [X] T010 Create backend/src/main.py with FastAPI app, CORS middleware, and router registration
- [X] T011 [P] Create backend/src/api/health.py with GET /health endpoint checking Qdrant and Groq connectivity
- [X] T012 Create Neon PostgreSQL schema: chat_sessions table and rate_limits table per data-model.md
- [X] T013 Create Qdrant Cloud collection "textbook_embeddings" with 384-dim vectors and payload schema

**Checkpoint**: Foundation ready - user story implementation can now begin

---

## Phase 3: User Story 1 - Browse Textbook Content (Priority: P1) ðŸŽ¯ MVP

**Goal**: Deliver readable, navigable textbook with 6 chapters and auto-generated sidebar

**Independent Test**: Deploy static Docusaurus site, verify all 6 chapters accessible within 3 clicks, sidebar shows all chapters

### Implementation for User Story 1

- [X] T014 [P] [US1] Create docs/intro.md - Chapter 1: Introduction to Physical AI with frontmatter (sidebar_position: 1)
- [X] T015 [P] [US1] Create docs/humanoid-basics.md - Chapter 2: Basics of Humanoid Robotics with frontmatter (sidebar_position: 2)
- [X] T016 [P] [US1] Create docs/ros2-fundamentals.md - Chapter 3: ROS 2 Fundamentals with frontmatter (sidebar_position: 3)
- [X] T017 [P] [US1] Create docs/digital-twin.md - Chapter 4: Digital Twin Simulation (Gazebo + Isaac) with frontmatter (sidebar_position: 4)
- [X] T018 [P] [US1] Create docs/vla-systems.md - Chapter 5: Vision-Language-Action Systems with frontmatter (sidebar_position: 5)
- [X] T019 [P] [US1] Create docs/capstone.md - Chapter 6: Capstone with frontmatter (sidebar_position: 6)
- [X] T020 [US1] Configure website/docusaurus.config.js with site metadata, theme, and docs plugin pointing to ../docs
- [X] T021 [US1] Configure website/sidebars.js with autogenerated sidebar from docs/ directory
- [X] T022 [US1] Create website/src/pages/index.js landing page with hero section and "Start Reading" CTA linking to /docs/intro
- [X] T023 [US1] Create website/src/css/custom.css with clean, minimal styling per constitution
- [X] T024 [US1] Verify Docusaurus build succeeds with npm run build in website/
- [X] T025 [US1] Configure GitHub Pages deployment in website/ (baseUrl, url settings)

**Checkpoint**: User Story 1 complete - Textbook is readable and navigable. Can deploy as MVP.

---

## Phase 4: User Story 2 - Ask Questions via RAG Chatbot (Priority: P2)

**Goal**: Deliver RAG chatbot that answers questions using ONLY textbook content with citations

**Independent Test**: Send question to /chat endpoint, verify response includes answer from book content with source citations

### Backend Implementation for User Story 2

- [X] T026 [US2] Create backend/src/services/embeddings.py with sentence-transformers MiniLM-L6-v2 embedding function
- [X] T027 [US2] Create backend/scripts/ingest.py to chunk markdown files (512 tokens, 50 overlap) and upload to Qdrant with chapter/section metadata
- [ ] T028 [US2] Run ingest.py to populate Qdrant with all 6 chapter embeddings
- [X] T029 [US2] Create backend/src/services/retrieval.py with Qdrant search function returning top-3 chunks with scores
- [X] T030 [US2] Create backend/src/services/generation.py with Groq Llama 3 client and system prompt constraining to book content only
- [X] T031 [US2] Implement confidence scoring in retrieval.py: high (>=0.7), medium (0.4-0.7), low (<0.4)
- [X] T032 [US2] Create backend/src/api/chat.py with POST /chat endpoint orchestrating retrieval â†’ generation â†’ response
- [X] T033 [US2] Add rate limiting middleware in backend/src/main.py checking rate_limits table (100 requests/hour per IP)
- [X] T034 [US2] Add "not covered in textbook" response handling for low confidence queries in chat.py

### Frontend Implementation for User Story 2

- [X] T035 [US2] Create website/src/components/ChatBot/ChatBot.jsx - floating button component (bottom-right position)
- [X] T036 [US2] Create website/src/components/ChatBot/ChatDrawer.jsx - slide-out drawer with message list and input
- [X] T037 [US2] Create website/src/components/ChatBot/ChatMessage.jsx - message bubble with source citations display
- [X] T038 [US2] Create website/src/components/ChatBot/api.js - fetch wrapper for /chat endpoint with error handling
- [X] T039 [US2] Create website/src/components/ChatBot/index.css - chatbot styling (drawer, messages, input)
- [X] T040 [US2] Integrate ChatBot component into website/src/theme/Root.js to appear on all pages
- [X] T041 [US2] Add loading state and "Backend unavailable" graceful degradation message in ChatDrawer.jsx
- [X] T042 [US2] Add confidence disclaimer display in ChatMessage.jsx for medium/low confidence responses

**Checkpoint**: User Story 2 complete - Users can ask questions and get answers with citations.

---

## Phase 5: User Story 3 - Select Text to Ask AI (Priority: P2)

**Goal**: Allow users to select text and ask AI for clarification with that context

**Independent Test**: Select text on chapter page, click "Ask AI", verify chatbot opens with selected text as context

### Backend Implementation for User Story 3

- [X] T043 [US3] Create backend/src/api/chat.py POST /chat/context endpoint accepting selected_text and chapter_slug
- [X] T044 [US3] Modify generation.py to include selected_text in prompt context when provided

### Frontend Implementation for User Story 3

- [X] T045 [US3] Create website/src/components/SelectToAsk/SelectToAsk.jsx - text selection listener with mouseup handler
- [X] T046 [US3] Create website/src/components/SelectToAsk/AskButton.jsx - floating "Ask AI" button appearing on selection
- [X] T047 [US3] Create website/src/components/SelectToAsk/index.css - button positioning and styling
- [X] T048 [US3] Implement text truncation (max 500 chars) with notice in SelectToAsk.jsx
- [X] T049 [US3] Wire SelectToAsk to ChatBot: clicking "Ask AI" opens drawer with selected text pre-filled
- [X] T050 [US3] Integrate SelectToAsk into docs pages via website/src/theme/DocItem/Content/index.js wrapper

**Checkpoint**: User Story 3 complete - Select-to-Ask feature works independently.

---

## Phase 6: User Story 4 - Read Content in Urdu (Priority: P3 - Optional)

**Goal**: Allow users to switch to Urdu language for content

**Independent Test**: Click language switcher, verify page content displays in Urdu

### Implementation for User Story 4

- [ ] T051 [P] [US4] Create docs/i18n/ur/docusaurus-plugin-content-docs/current/ directory structure
- [ ] T052 [P] [US4] Create Urdu translation of intro.md in i18n/ur/.../intro.md
- [ ] T053 [P] [US4] Create Urdu translation of humanoid-basics.md
- [ ] T054 [P] [US4] Create Urdu translation of ros2-fundamentals.md
- [ ] T055 [P] [US4] Create Urdu translation of digital-twin.md
- [ ] T056 [P] [US4] Create Urdu translation of vla-systems.md
- [ ] T057 [P] [US4] Create Urdu translation of capstone.md
- [ ] T058 [US4] Configure website/docusaurus.config.js i18n settings with defaultLocale: 'en', locales: ['en', 'ur']
- [ ] T059 [US4] Add language switcher to navbar in docusaurus.config.js themeConfig

**Checkpoint**: User Story 4 complete - Urdu content available via language switcher.

---

## Phase 7: User Story 5 - Personalize Learning Experience (Priority: P3 - Optional)

**Goal**: Allow dark mode toggle and bookmarking

**Independent Test**: Toggle dark mode, verify it persists on refresh; bookmark a section, verify it appears in bookmarks page

### Implementation for User Story 5

- [ ] T060 [US5] Enable Docusaurus color mode in website/docusaurus.config.js themeConfig (defaultMode: 'light', respectPrefersColorScheme: true)
- [ ] T061 [US5] Create website/src/components/Bookmarks/BookmarkButton.jsx - bookmark toggle for current section
- [ ] T062 [US5] Create website/src/components/Bookmarks/useBookmarks.js - localStorage hook for bookmark state
- [ ] T063 [US5] Create website/src/pages/bookmarks.js - page listing all bookmarked sections with links
- [ ] T064 [US5] Add BookmarkButton to section headings via MDX component override
- [ ] T065 [US5] Create website/src/components/Bookmarks/index.css - bookmark styling

**Checkpoint**: User Story 5 complete - Dark mode and bookmarks functional.

---

## Phase 8: Polish & Cross-Cutting Concerns

**Purpose**: Improvements that affect multiple user stories

- [X] T066 [P] Create README.md at repository root with project overview, setup instructions, and deployment guide
- [X] T067 [P] Create backend/README.md with API documentation and local development instructions
- [X] T068 Verify all endpoints match contracts/openapi.yaml specification
- [ ] T069 Run lighthouse audit on built site, ensure performance score >90
- [ ] T070 Verify <3s page load time on deployed site
- [ ] T071 Verify <5s chatbot response time under normal load
- [ ] T072 Configure Railway/Vercel deployment for backend with environment variables
- [ ] T073 Run quickstart.md validation end-to-end
- [ ] T074 Final review: verify all 6 chapters accessible, chatbot functional, no broken links

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: No dependencies - can start immediately
- **Foundational (Phase 2)**: Depends on Setup completion - BLOCKS all user stories
- **User Story 1 (Phase 3)**: Depends on Setup only (no backend needed)
- **User Story 2 (Phase 4)**: Depends on Foundational (backend) + User Story 1 (content for embeddings)
- **User Story 3 (Phase 5)**: Depends on User Story 2 (uses chatbot backend)
- **User Story 4 (Phase 6)**: Depends on User Story 1 (content must exist to translate)
- **User Story 5 (Phase 7)**: Depends on User Story 1 (needs pages to bookmark)
- **Polish (Phase 8)**: Depends on all desired user stories being complete

### User Story Dependencies

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Setup (P1)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Foundational    â”‚ â”‚   US1      â”‚ â”‚   US1      â”‚
    â”‚ (Backend only)  â”‚ â”‚ (Content)  â”‚ â”‚ (Frontend) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â”‚                â”‚              â”‚
             â”‚                â–¼              â”‚
             â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
             â””â”€â”€â”€â”€â”€â”€â–ºâ”‚     US2        â”‚â—„â”€â”€â”€â”€â”€â”˜
                     â”‚ (RAG Chatbot)  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚     US3        â”‚
                     â”‚ (Select-to-Ask)â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     US4         â”‚    â”‚     US5         â”‚
    â”‚ (Urdu - Opt)    â”‚    â”‚ (Personalize)   â”‚
    â”‚ Depends: US1    â”‚    â”‚ Depends: US1    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Within Each User Story

- Models/schemas before services
- Services before API endpoints
- Backend before frontend integration
- Core functionality before error handling/edge cases

### Parallel Opportunities

**Phase 1 (Setup)**:
- T002, T003, T004, T005, T006, T007 can all run in parallel

**Phase 2 (Foundational)**:
- T009, T011 can run in parallel after T008

**Phase 3 (US1 - Content)**:
- T014-T019 (all 6 chapters) can run in parallel
- T020-T025 sequential (Docusaurus config depends on chapters)

**Phase 4 (US2 - Chatbot)**:
- T026 can start immediately
- T035-T042 (frontend) can run in parallel with T026-T034 (backend) until integration

**Phase 6 (US4 - Urdu)**:
- T051-T057 (all translations) can run in parallel

---

## Parallel Example: User Story 1 (Content)

```bash
# Launch all chapter creation tasks in parallel:
Task: "Create docs/intro.md - Chapter 1"
Task: "Create docs/humanoid-basics.md - Chapter 2"
Task: "Create docs/ros2-fundamentals.md - Chapter 3"
Task: "Create docs/digital-twin.md - Chapter 4"
Task: "Create docs/vla-systems.md - Chapter 5"
Task: "Create docs/capstone.md - Chapter 6"

# Then sequential configuration:
Task: "Configure docusaurus.config.js"
Task: "Configure sidebars.js"
Task: "Create landing page"
```

---

## Implementation Strategy

### MVP First (User Story 1 Only)

1. Complete Phase 1: Setup (T001-T007)
2. Complete Phase 3: User Story 1 (T014-T025)
3. **STOP and VALIDATE**: Deploy static textbook to GitHub Pages
4. Verify: All 6 chapters accessible, sidebar works, navigation works
5. **This is a deployable MVP** - educational content is available

### Add Chatbot (User Stories 1+2)

1. Complete Phase 2: Foundational (T008-T013)
2. Complete Phase 4: User Story 2 (T026-T042)
3. **VALIDATE**: Chatbot answers questions with citations
4. Deploy backend to Railway, update frontend API URL

### Full Feature Set

1. Add User Story 3 (T043-T050) - Select-to-Ask
2. Optionally add User Story 4 (T051-T059) - Urdu
3. Optionally add User Story 5 (T060-T065) - Personalization
4. Complete Polish (T066-T074)

---

## Summary

| Phase | Tasks | Parallel | Description |
|-------|-------|----------|-------------|
| Setup | T001-T007 | 6 | Project initialization |
| Foundational | T008-T013 | 2 | Backend infrastructure |
| US1 (P1) | T014-T025 | 6 | Textbook content & navigation |
| US2 (P2) | T026-T042 | 8 | RAG chatbot |
| US3 (P2) | T043-T050 | 0 | Select-to-Ask |
| US4 (P3) | T051-T059 | 7 | Urdu translation (optional) |
| US5 (P3) | T060-T065 | 0 | Personalization (optional) |
| Polish | T066-T074 | 2 | Final validation |

**Total Tasks**: 74
**MVP Scope**: T001-T007, T014-T025 (19 tasks for deployable textbook)
**Core Product**: MVP + T008-T013, T026-T050 (52 tasks for textbook with chatbot)
